<!DOCTYPE html>
<html>

<head>
    <title>M3 Signature Taskpane</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Office.js -->
    <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    <script src="commands.js"></script>
    <!-- Fluent UI (Office UI Fabric Core) CSS for a native Microsoft look -->
    <link rel="stylesheet" href="https://unpkg.com/office-ui-fabric-core@11.1.0/dist/css/fabric.min.css">
    <link rel="stylesheet" href="https://unpkg.com/office-ui-fabric-js@1.5.0/dist/css/fabric.components.min.css">
    <style>
        body {
            padding: 20px;
            background-color: #f3f2f1;
            font-family: "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, BlinkMacSystemFont, "Roboto", "Helvetica Neue", sans-serif;
        }

        .container {
            max-width: 400px;
            margin: auto;
            background-color: #ffffff;
            padding: 20px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        /* Fluent-styled radio buttons using Office UI Fabric Core classes */
        .ms-ChoiceField {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .ms-ChoiceField-input {
            margin-right: 8px;
        }

        .ms-Button {
            margin-top: 20px;
            width: 100%;
        }

        section.samples {
            margin-top: 20px;
        }

        section.samples .ms-Button,
        section.setup .ms-Button {
            display: block;
            margin-bottom: 5px;
            margin-left: 20px;
            min-width: 80px;
        }
    </style>
</head>

<body class="ms-Fabric">
    <div class="container">
        <h2 class="ms-fontSize-24 ms-fontWeight-semibold">Select Your Default Signature</h2>
        <p class="ms-fontSize-16">Choose one of your signatures. This will automatically be applied when composing new
            emails.</p>

        <form id="signatureForm">
            <div class="ms-ChoiceField">
                <input class="ms-ChoiceField-input" type="radio" id="radioMona" name="signatureOption"
                    value="monaSignature">
                <label class="ms-ChoiceField-field" for="radioMona">
                    <span class="ms-Label">Mona</span>
                </label>
            </div>
            <div class="ms-ChoiceField">
                <input class="ms-ChoiceField-input" type="radio" id="radioMorgan" name="signatureOption"
                    value="morganSignature">
                <label class="ms-ChoiceField-field" for="radioMorgan">
                    <span class="ms-Label">Morgan</span>
                </label>
            </div>
            <div class="ms-ChoiceField">
                <input class="ms-ChoiceField-input" type="radio" id="radioMorven" name="signatureOption"
                    value="morvenSignature">
                <label class="ms-ChoiceField-field" for="radioMorven">
                    <span class="ms-Label">Morven</span>
                </label>
            </div>
            <div class="ms-ChoiceField">
                <input class="ms-ChoiceField-input" type="radio" id="radioM2" name="signatureOption"
                    value="m2Signature">
                <label class="ms-ChoiceField-field" for="radioM2">
                    <span class="ms-Label">M2</span>
                </label>
            </div>
            <div class="ms-ChoiceField">
                <input class="ms-ChoiceField-input" type="radio" id="radioM3" name="signatureOption"
                    value="m3Signature">
                <label class="ms-ChoiceField-field" for="radioM3">
                    <span class="ms-Label">M3</span>
                </label>
            </div>

            <button type="submit" class="ms-Button ms-Button--primary">
                <span class="ms-Button-label">Set Default Signature</span>
            </button>
        </form>
    </div>

    <section class="ms-Fabric ms-font-m">
        <p>This sample shows how to set, save, and get the custom per-item properties of an add-in.</p>
    </section>
    <section class="ms-Fabric samples ms-font-m">
        <h3>Try it out</h3>
        <p>First load the <a href="https://learn.microsoft.com/javascript/api/outlook/office.customproperties"
                target="_blank">CustomProperties</a> object of the mail item.</p>
        <button id="load" class="ms-Button">
            <div class="ms-Button-label">Load custom properties</div>
        </button>
        <div class="ms-TextField">
            <label class="ms-Label">Property name:</label>
            <input id="set-property-name" class="ms-TextField-field" type="text" value="hello" placeholder="">
        </div>
        <div class="ms-TextField">
            <label class="ms-Label">Property value:</label>
            <input id="property-value" class="ms-TextField-field" type="text" value="world" placeholder="">
        </div>
        <button id="set" class="ms-Button">
            <div class="ms-Button-label">Set</div>
        </button>
        <div class="ms-TextField">
            <label class="ms-Label">Property name:</label>
            <input id="get-property-name" class="ms-TextField-field" type="text" value="hello" placeholder="">
        </div>
        <button id="get" class="ms-Button">
            <div class="ms-Button-label">Get</div>
        </button>
        <button id="get-all" class="ms-Button">
            <div class="ms-Button-label">Get all</div>
        </button>
        <div class="ms-TextField">
            <label class="ms-Label">Property name:</label>
            <input id="remove-property-name" class="ms-TextField-field" type="text" value="hello" placeholder="">
        </div>
        <button id="remove" class="ms-Button">
            <div class="ms-Button-label">Remove</div>
        </button>
        <button id="save" class="ms-Button">
            <div class="ms-Button-label">Save all</div>
        </button>
    </section>

    <script>
        let customProps;
        document.getElementById("load").addEventListener("click", load);
        document.getElementById("get").addEventListener("click", get);
        document.getElementById("get-all").addEventListener("click", getAll);
        document.getElementById("set").addEventListener("click", set);
        document.getElementById("remove").addEventListener("click", remove);
        document.getElementById("save").addEventListener("click", save);

        Office.initialize = function (reason) {
            console.log('Taskpane (Fluent UI) initialized on mobile/web.');

            document.getElementById('signatureForm').addEventListener('submit', function (e) {
                e.preventDefault();
                // Get the selected signature from the radio inputs.
                var selectedRadio = document.querySelector('input[name="signatureOption"]:checked');
                if (selectedRadio) {
                    // Save the default signature locally.
                    localStorage.setItem("defaultSignature", selectedRadio.value);

                    // Directly call your addSignature function.

                    // if (typeof addSignature === "function") {
                    // const signature = ["monaSignature", "morganSignature", "morvenSignature", "m2Signature", "m3Signature"];
                    // const signatureIndex = signature.indexOf(selectedRadio.value);
                    // addSignature(signatureIndex, null);
                    // } else {
                    //     console.error("addSignature function is not defined.");
                    // }

                    // Close the taskpane; use Office.context.ui.close() if in a dialog, or window.close().
                    if (Office.context?.ui) {
                        Office.context.ui.closeContainer();
                    } else {
                        window.close();
                    }
                } else {
                    alert("Please select a signature before submitting.");
                }
            });
        };

        let customProps;

        document.getElementById("load").addEventListener("click", load);
        document.getElementById("get").addEventListener("click", get);
        document.getElementById("get-all").addEventListener("click", getAll);
        document.getElementById("set").addEventListener("click", set);
        document.getElementById("remove").addEventListener("click", remove);
        document.getElementById("save").addEventListener("click", save);

        function load() {
            Office.context.mailbox.item.loadCustomPropertiesAsync((result) => {
                if (result.status === Office.AsyncResultStatus.Failed) {
                    console.error(`loadCustomPropertiesAsync failed with message ${result.error.message}`);
                    return;
                }

                customProps = result.value;
                console.log("Loaded the CustomProperties object.");
            });
        }

        function get() {
            const propertyName = (document.getElementById("get-property-name") as HTMLInputElement).value;
            const propertyValue = customProps.get(propertyName);
            console.log(`The value of custom property "${propertyName}" is "${propertyValue}".`);
        }

        function getAll() {
            let allCustomProps;
            if (Office.context.requirements.isSetSupported("Mailbox", "1.9")) {
                allCustomProps = customProps.getAll();
            } else {
                allCustomProps = customProps["rawData"];
            }

            console.log(allCustomProps);
        }

        function set() {
            const propertyName = (document.getElementById("set-property-name") as HTMLInputElement).value;
            const propertyValue = (document.getElementById("property-value") as HTMLInputElement).value;
            customProps.set(propertyName, propertyValue);
            console.log(`Custom property "${propertyName}" set to value "${propertyValue}".`);
        }

        function remove() {
            const propertyName = (document.getElementById("remove-property-name") as HTMLInputElement).value;
            customProps.remove(propertyName);
            console.log(`Custom property "${propertyName}" removed.`);
        }

        function save() {
            customProps.saveAsync((result) => {
                if (result.status === Office.AsyncResultStatus.Failed) {
                    console.error(`saveAsync failed with message ${result.error.message}`);
                    return;
                }

                console.log(`Custom properties saved with status: ${result.status}`);
            });
        }
    </script>
</body>

</html>